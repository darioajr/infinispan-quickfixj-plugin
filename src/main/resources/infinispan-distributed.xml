<?xml version="1.0" encoding="UTF-8"?>
<infinispan
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:infinispan:config:14.0 https://infinispan.org/schemas/infinispan-config-14.0.xsd"
    xmlns="urn:infinispan:config:14.0">
    
    <!-- Configuração global do cluster -->
    <cache-container default-cache="default" name="quickfixj-cache-container">
        <transport cluster="quickfixj-cluster" stack="tcp"/>
        
        <!-- Configuração para mensagens -->
        <distributed-cache name="quickfixj-messages" 
                          mode="SYNC" 
                          owners="2" 
                          statistics="true">
            <encoding media-type="application/x-protostream"/>
            <expiration lifespan="86400000" max-idle="43200000"/> <!-- 24h lifespan, 12h max-idle -->
            <memory max-count="50000" when-full="REMOVE"/>
            <state-transfer timeout="60000"/>
            
            <!-- Persistência opcional -->
            <persistence>
                <soft-index-file-store>
                    <data path="data/messages"/>
                    <index path="index/messages"/>
                </soft-index-file-store>
            </persistence>
        </distributed-cache>
        
        <!-- Configuração para sequence numbers -->
        <distributed-cache name="quickfixj-sequences" 
                          mode="SYNC" 
                          owners="2" 
                          statistics="true">
            <encoding media-type="application/x-protostream"/>
            <expiration lifespan="172800000"/> <!-- 48h lifespan -->
            <memory max-count="10000" when-full="REMOVE"/>
            <state-transfer timeout="60000"/>
            
            <persistence>
                <soft-index-file-store>
                    <data path="data/sequences"/>
                    <index path="index/sequences"/>
                </soft-index-file-store>
            </persistence>
        </distributed-cache>
        
        <!-- Configuração para informações de sessão -->
        <distributed-cache name="quickfixj-sessions" 
                          mode="SYNC" 
                          owners="2" 
                          statistics="true">
            <encoding media-type="application/x-protostream"/>
            <expiration lifespan="172800000"/> <!-- 48h lifespan -->
            <memory max-count="5000" when-full="REMOVE"/>
            <state-transfer timeout="60000"/>
            
            <persistence>
                <soft-index-file-store>
                    <data path="data/sessions"/>
                    <index path="index/sessions"/>
                </soft-index-file-store>
            </persistence>
        </distributed-cache>
        
        <!-- Configuração para settings -->
        <distributed-cache name="quickfixj-settings" 
                          mode="SYNC" 
                          owners="2" 
                          statistics="true">
            <encoding media-type="application/x-protostream"/>
            <expiration lifespan="604800000"/> <!-- 7 dias -->
            <memory max-count="1000" when-full="REMOVE"/>
            <state-transfer timeout="60000"/>
            
            <persistence>
                <soft-index-file-store>
                    <data path="data/settings"/>
                    <index path="index/settings"/>
                </soft-index-file-store>
            </persistence>
        </distributed-cache>
        
        <!-- Cache padrão -->
        <local-cache name="default" statistics="false">
            <encoding media-type="application/x-protostream"/>
            <expiration lifespan="3600000"/> <!-- 1h -->
            <memory max-count="1000" when-full="REMOVE"/>
        </local-cache>
    </cache-container>
</infinispan>
